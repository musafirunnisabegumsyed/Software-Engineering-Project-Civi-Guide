<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Civi Guide - Live Navigation</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      overflow: hidden;
    }

    /* Splash Screen */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('https://images.unsplash.com/photo-1564866657316-f7a44882f5c1?auto=format&fit=crop&w=1470&q=80') center/cover no-repeat;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: brightness(0.5);
    }
    #splash h1 {
      font-size: 50px;
      color: #00ffff;
      opacity: 0;
      transform: translateY(-150px);
      animation: slideFade 0.5s forwards;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
    }
    #splash p {
      margin-top: 15px;
      font-size: 20px;
      color: #ffeb3b;
      opacity: 0;
      animation: glowPulse 0.7s infinite alternate;
      animation-delay: 0.5s;
      text-shadow: 0 0 5px #ffeb3b;
    }
    @keyframes slideFade {
      0% { transform: translateY(-150px); opacity: 0; }
      70% { transform: translateY(20px); opacity: 1; }
      100% { transform: translateY(0); opacity: 1; }
    }
    @keyframes glowPulse {
      from { text-shadow: 0 0 5px #ffeb3b, 0 0 10px #ffeb3b; opacity: 0.8; }
      to { text-shadow: 0 0 20px #ffeb3b, 0 0 40px #ffeb3b; opacity: 1; }
    }

    /* Main Content */
    #main { display: none; height: 100%; flex-direction: column; }
    #map { flex: 1; }

    /* Sidebar */
  .sidebar {
    height: 100%;
    width: 0;
    position: fixed;
    top: 0; left: 0;
    background: linear-gradient(145deg, #111, #222);
    overflow-x: hidden;
    transition: 0.3s;
    padding-top: 60px;
    z-index: 2000;
    color: white;
    box-shadow: 2px 0 10px rgba(0,0,0,0.7);
    border-right: 1px solid #333;
  }
  .sidebar h2, .sidebar h3 {
    padding-left: 15px;
    font-size: 18px;
    margin-bottom: 10px;
    color: #00ffff;
  }
  .sidebar a {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 15px;
    text-decoration: none;
    font-size: 16px;
    color: white;
    transition: 0.3s ease;
    border-radius: 6px;
  }
  .sidebar a:hover {
    background: #00ffff;
    color: #111;
    font-weight: bold;
    transform: scale(1.05);
  }
  .sidebar a i {
    width: 24px;
    text-align: center;
    font-size: 18px;
    color: #00ffff;
  }
  .sidebar ul { list-style: none; padding: 0; margin: 0 0 15px 15px; line-height: 1.8; }
  .sidebar p { padding: 0 15px 15px 15px; font-style: italic; color: #ddd; }
  .badge { padding: 3px 8px; border-radius: 6px; font-weight: bold; margin-left: 5px; }
  .green { background:#4CAF50; color:white; }
  .blue { background:#2196F3; color:white; }
  .red { background:#f44336; color:white; }
  .yellow { background:#FFC107; color:black; }
  .quote-card {
    background: #333;
    padding: 12px 15px;
    border-radius: 10px;
    margin: 0 15px 15px 15px;
    font-style: italic;
    color: #ffeb3b;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }
    /* Hamburger */
    .hamburger {
      position: fixed;
      top: 15px; left: 15px;
      z-index: 3000;
      cursor: pointer;
      font-size: 28px;
      color: #00ffff;
      background: #222;
      padding: 10px 14px;
      border-radius: 8px;
      user-select: none;
      transition: 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    .hamburger:hover { background: #ffeb3b; color: #111; transform: scale(1.1); }
    /* Topbar */
    .topbar {
      display: flex;
      justify-content: center;
      gap: 12px;
      padding: 12px;
      background: #1a1a1a;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
      border-radius: 0 0 12px 12px;
      z-index: 1001;
    }
    .top-input {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #555;
      background: #222;
      color: white;
      width: 180px;
      transition: 0.3s;
    }
    .top-input:focus {
      border-color: #00ffff;
      box-shadow: 0 0 8px #00ffff;
      outline: none;
    }
    .top-btn {
      padding: 10px 14px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      background: #00ffff;
      color: #111;
      font-size: 18px;
      transition: 0.3s;
    }
    .top-btn:hover {
      background: #ffeb3b;
      color: #111;
      transform: scale(1.1);
    }

    #distanceBox {
      position: absolute; top: 60px; right: 20px;
      background: rgba(0,0,0,0.7); color: white;
      padding: 8px 12px; border-radius: 8px; z-index: 1000;
    }
    .leaflet-routing-container, .leaflet-routing-container * {
      color: black !important;
      font-weight: 500;
    }

    /* Feedback Popup */
    #feedbackPopup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #1e1e1e;
      color: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
      display: none;
      z-index: 4000;
      width: 300px;
      text-align: center;
    }
    #feedbackPopup .closeBtn {
      position: absolute;
      top: 8px; right: 12px;
      cursor: pointer;
      font-size: 18px;
      color: #ff3b3b;
    }
    #feedbackPopup .stars span {
      font-size: 24px;
      cursor: pointer;
      margin: 0 3px;
      transition: transform 0.2s;
    }
    #feedbackPopup .stars span:hover {
      transform: scale(1.3);
      color: #ffeb3b;
    }
    #feedbackPopup textarea {
      width: 100%;
      margin-top: 12px;
      padding: 8px;
      border-radius: 6px;
      border: none;
      resize: vertical;
      font-size: 14px;
    }
    #feedbackPopup button {
      margin-top: 12px;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      background: #00ffff;
      color: #111;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    #feedbackPopup button:hover {
      background: #4CAF50;
      color: #fff;
    }
  </style>
</head>
<body>

  <!-- Splash Screen -->
  <div id="splash">
    <h1>Welcome to CiviGuide</h1>
    <p>Citizen Information & Services Platform</p>
  </div>

  <!-- Main Content -->
  <div id="main">
    <div class="hamburger" onclick="toggleSidebar()">&#9776;</div>

    <!-- Sidebar -->
    <div id="mySidebar" class="sidebar">
      <h2>Features</h2>
      <a href="home.html"><i class="fas fa-home"></i> Home</a>
      <a href="live.html"><i class="fa-solid fa-triangle-exclamation"></i> Disaster Zone Detection</a>
      <a href="alternate.html"><i class="fa-solid fa-route"></i> Alternate Route Suggestion</a>
      <a href="borderalert.html"><i class="fa-solid fa-map"></i> National Border Alert</a>
      <a href="emergence.html"><i class="fa-solid fa-ambulance"></i> Emergency Services Locator</a>
      <a href="safetytip.html"><i class="fa-solid fa-shield-halved"></i> Safety Tips & Guides</a>

      <hr style="border:1px solid #444; margin:20px 0;">
      <h3>Emergency Numbers</h3>
      <ul>
        <li>üöë Ambulance: <span class="badge green">108 / 102</span></li>
        <li>üëÆ Police: <span class="badge blue">100</span></li>
        <li>üî• Fire: <span class="badge red">101</span></li>
        <li>üåê NDRF: <span class="badge yellow">1078</span></li>
      </ul>

      <hr style="border:1px solid #444; margin:20px 0;">
      <h3>Quote of the Day</h3>
      <div class="quote-card">"Preparedness today saves lives tomorrow."</div>
    </div>

    <!-- Topbar -->
    <div class="topbar">
      <input id="source" placeholder="Source" class="top-input">
      <button onclick="reverseLocations()" class="top-btn">&#8646;</button>
      <input id="destination" placeholder="Destination" class="top-input">
      <button id="searchBtn" class="top-btn">&#128269;</button>
      <button id="micButton" class="top-btn">&#127908;</button>
    </div>

    <!-- Map -->
    <div id="map"></div>
    <div id="distanceBox">Distance: 0 km | ETA: 0 min</div>
  </div>

  <!-- Feedback Popup -->
  <div id="feedbackPopup">
    <span class="closeBtn" onclick="closeFeedback()">&times;</span>
    <h3>Rate Our Website</h3>
    <div class="stars">
      <span>&#9733;</span><span>&#9733;</span><span>&#9733;</span><span>&#9733;</span><span>&#9733;</span>
    </div>
    <textarea placeholder="Write your feedback here..."></textarea>
    <button onclick="submitFeedback()">Submit</button>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
  <script>
    // Splash and map initialization
    setTimeout(() => {
      document.getElementById("splash").style.display = "none";
      document.getElementById("main").style.display = "flex";
      initMap();
      checkVisitCount();
    }, 1500);

    // Map setup
    function initMap() {
      var map = L.map('map').setView([22.0, 78.0], 5);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

      let routingControl = null;
      let routeInstructions = [];
      let currentStepIndex = 0;

      window.searchRoute = function() {
        const src = document.getElementById('source').value.trim();
        const dest = document.getElementById('destination').value.trim();
        if (!src || !dest) { alert("Enter both source and destination"); return; }

        const nominatimURL = place => `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}`;
        Promise.all([fetch(nominatimURL(src)).then(r => r.json()), fetch(nominatimURL(dest)).then(r => r.json())])
          .then(([srcData, destData]) => {
            if (!srcData.length) { alert("Source not found"); return; }
            if (!destData.length) { alert("Destination not found"); return; }

            const srcLatLng = L.latLng(srcData[0].lat, srcData[0].lon);
            const destLatLng = L.latLng(destData[0].lat, destData[0].lon);

            if (routingControl) map.removeControl(routingControl);
            routingControl = L.Routing.control({
              waypoints: [srcLatLng, destLatLng],
              lineOptions: { styles: [{ color: 'red', opacity: 0.8, weight: 5 }] },
              router: L.Routing.osrmv1({ serviceUrl: 'https://router.project-osrm.org/route/v1' }),
              show: true
            }).addTo(map);

            routingControl.on('routesfound', function(e) {
              const route = e.routes[0];
              const distanceKm = (route.summary.totalDistance / 1000).toFixed(2);
              const durationMin = Math.round(route.summary.totalTime / 60);
              document.getElementById('distanceBox').innerText = `Distance: ${distanceKm} km | ETA: ${durationMin} min`;
              routeInstructions = route.instructions;
              currentStepIndex = 0;
            });
          });
      };

      document.getElementById('searchBtn').onclick = searchRoute;
      window.reverseLocations = function() {
        let s = document.getElementById('source'), d = document.getElementById('destination');
        [s.value, d.value] = [d.value, s.value];
      };

      document.getElementById('micButton').onclick = function () {
        if (routeInstructions.length === 0) { alert("No route loaded."); return; }
        currentStepIndex = 0;
        speak("Starting navigation. Follow the instructions.");
        let interval = setInterval(() => {
          if (currentStepIndex < routeInstructions.length) {
            speak(routeInstructions[currentStepIndex].text);
            currentStepIndex++;
          } else {
            speak("You have arrived at your destination.");
            clearInterval(interval);
          }
        }, 8000);
      };

      function speak(text) {
        let utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-US';
        window.speechSynthesis.speak(utter);
      }

      window.toggleSidebar = function() {
        const sidebar = document.getElementById("mySidebar");
        sidebar.style.width = sidebar.style.width === "250px" ? "0" : "250px";
      };
    }

    // Feedback popup logic
    function checkVisitCount() {
      let visitCount = parseInt(localStorage.getItem('visitCount') || 0);
      visitCount++;
      localStorage.setItem('visitCount', visitCount);

      // Show feedback popup every 5 visits
      if (visitCount % 5 === 0) {
        openFeedback();
      }
    }

    function openFeedback() {
      document.getElementById('feedbackPopup').style.display = 'block';
    }

    function closeFeedback() {
      document.getElementById('feedbackPopup').style.display = 'none';
    }

    function submitFeedback() {
      alert('Thank you for your feedback!');
      closeFeedback();
    }
  </script>
</body>
</html>
